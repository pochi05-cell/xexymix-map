<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ì ì‹œë¯¹ìŠ¤ ì¬ê³ ì§€ë„ (ìƒ‰ìƒë³µêµ¬+ë©”ëª¨í˜•)</title>
    <style>
        :root { --yellow: #ffdb6d; --brown: #d9d2ae; --blue: #cfd8dc; --accent: #4CAF50; --highlight: #ff4d4d; }
        body { font-family: -apple-system, sans-serif; background: #333; margin: 0; display: flex; flex-direction: column; align-items: center; }
        
        /* UI ë° í—¤ë” */
        .global-header { width: 360px; background: white; display: flex; gap: 8px; padding: 10px; border-radius: 0 0 15px 15px; position: sticky; top: 0; z-index: 1000; box-sizing: border-box; }
        #searchInput { flex: 1; padding: 10px; border: 1px solid #ddd; border-radius: 8px; font-size: 14px; }
        .btn { width: 42px; height: 42px; border: none; border-radius: 8px; background: #f0f0f0; font-size: 20px; cursor: pointer; display: flex; align-items: center; justify-content: center; }
        .btn.active { background: var(--highlight); color: white; }
        
        #drawer { position: fixed; left: -290px; top: 0; width: 280px; height: 100%; background: #fff; z-index: 2000; transition: 0.3s; box-shadow: 2px 0 10px rgba(0,0,0,0.3); display: flex; flex-direction: column; }
        #drawer.open { left: 0; }
        .drawer-content { flex: 1; overflow-y: auto; padding: 15px; }
        .prod-item { padding: 12px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; cursor: pointer; }
        .prod-item.selected { background: #e8f5e9; border: 2px solid var(--accent); border-radius: 6px; }

        #placementBar { display:none; background:var(--accent); color:white; width:360px; padding:10px; text-align:center; font-size:13px; font-weight:bold; box-sizing:border-box; border-radius: 8px; margin-top: 5px; }

        /* ì§€ë„ ë° ë°•ìŠ¤ ìƒ‰ìƒ í´ë˜ìŠ¤ */
        .map-container { background: white; width: 360px; height: 740px; position: relative; border-radius: 15px; margin: 10px 0; overflow: hidden; box-shadow: 0 4px 10px rgba(0,0,0,0.3); }
        .area-label { background: #eee; padding: 12px; text-align: center; font-weight: bold; }
        .box { position: absolute; border: 1.5px solid #333; display: flex; align-items: center; justify-content: center; font-size: 10px; font-weight: bold; cursor: pointer; border-radius: 2px; }
        
        /* [ìƒ‰ìƒ ë³µêµ¬] */
        .yellow { background-color: var(--yellow) !important; }
        .brown { background-color: var(--brown) !important; }
        .blue { background-color: var(--blue) !important; }
        
        .island-y { transform: rotate(-45deg); width: 68px; height: 68px; }
        .island-br { transform: rotate(-45deg); width: 45px; height: 45px; }
        .blink { animation: blink 0.6s infinite; background-color: var(--highlight) !important; color: white !important; z-index: 100; }
        @keyframes blink { 50% { opacity: 0.3; } }

        /* íŒì—… */
        #overlay { display:none; position:fixed; inset:0; background:rgba(0,0,0,0.8); z-index:3000; align-items:flex-end; justify-content:center; }
        .pop { background:white; width:100%; max-width:400px; border-radius:20px 20px 0 0; padding: 20px; box-sizing: border-box; }
        .layer-row { display: flex; flex-direction: column; gap: 5px; margin-bottom: 12px; background: #f9f9f9; padding: 10px; border-radius: 8px; border: 1px solid #eee; }
        textarea { width: 100%; height: 55px; border: 1px solid #ddd; border-radius: 5px; resize: none; padding: 8px; font-size: 14px; box-sizing: border-box; }
    </style>
</head>
<body>

<div id="drawer">
    <div style="padding:15px; background:#f8f8f8; font-weight:bold; display:flex; justify-content:space-between;">ğŸ“¦ ë§ˆìŠ¤í„° ë¦¬ìŠ¤íŠ¸ <button onclick="toggleDrawer()" style="border:none; background:none; font-size:22px;">Ã—</button></div>
    <div class="drawer-content">
        <input type="text" id="newProd" style="width:100%; padding:12px; box-sizing:border-box; border:1px solid #ddd; border-radius:8px;" placeholder="í’ˆë²ˆ ì…ë ¥ í›„ ì—”í„°" onkeypress="addProd(event)">
        <div id="prodList"></div>
    </div>
</div>

<div class="global-header">
    <button class="btn" onclick="toggleDrawer()">ğŸ“‹</button>
    <input type="text" id="searchInput" placeholder="í’ˆë²ˆ ë˜ëŠ” ë©”ëª¨ ê²€ìƒ‰..." onkeyup="search(this.value)">
    <button id="editBtn" class="btn" onclick="toggleEdit()">âœï¸</button>
</div>

<div id="placementBar">ğŸ“ [<span id="selName"></span>] ë°°ì¹˜ ì¤‘ - ë°•ìŠ¤ë¥¼ í´ë¦­í•˜ì„¸ìš”</div>

<div class="main-wrapper">
    <div class="map-container" id="shopMap"><div class="area-label">&lt;ë§¤ì¥&gt;</div></div>
    <div class="map-container" id="stockMap" style="height: 400px;"><div class="area-label">&lt;ì°½ê³ &gt;</div></div>
</div>

<div id="overlay">
    <div class="pop">
        <h3 id="popTitle" style="margin:0 0 15px 0;"></h3>
        <div id="popLayers" style="max-height: 450px; overflow-y: auto;"></div>
        <button onclick="save()" style="width:100%; padding:15px; background:var(--accent); color:white; border:none; border-radius:10px; margin-top:15px; font-weight:bold;">ì €ì¥ ë° ë‹«ê¸°</button>
        <button onclick="closePop()" style="width:100%; padding:10px; background:#eee; border:none; border-radius:10px; margin-top:8px;">ì·¨ì†Œ</button>
    </div>
</div>

<script>
    // [ì •í™•í•œ ìƒ‰ìƒ ë°ì´í„° ì—°ê²°]
    const shopBoxes = [
        {id:'Y1', c:'yellow', t:70, l:60, w:90, h:35, f:2}, {id:'Y2', c:'yellow', t:70, r:30, w:90, h:35, f:2},
        {id:'Y3', c:'yellow island-y', t:160, l:135, f:4}, {id:'Y4', c:'yellow island-y', t:208, l:183, f:4},
        {id:'Br1', c:'brown island-br', t:208, l:111, f:4}, {id:'Br2', c:'brown island-br', t:240, l:143, f:4},
        {id:'B1', c:'blue', t:130, l:20, w:35, h:55, f:1}, {id:'B2', c:'blue', t:195, l:20, w:35, h:55, f:1},
        {id:'B3', c:'blue', t:260, l:20, w:35, h:55, f:1}, {id:'B4', c:'blue', t:325, l:20, w:35, h:55, f:1},
        {id:'B5', c:'blue', t:130, r:25, w:35, h:55, f:1}, {id:'B6', c:'blue', t:195, r:25, w:35, h:55, f:1},
        {id:'B7', c:'blue', t:260, r:25, w:35, h:55, f:1}, {id:'B8', c:'blue', t:325, r:25, w:35, h:55, f:1},
        {id:'B9', c:'blue', t:395, l:85, w:70, h:38, f:1}, {id:'B10', c:'blue', t:395, r:85, w:70, h:38, f:1},
        {id:'Y5', c:'yellow', t:450, r:25, w:38, h:70, f:4}, {id:'Y6', c:'yellow', t:450, l:220, w:38, h:70, f:4},
        {id:'Br3', c:'brown', t:585, l:65, w:32, h:50, f:2}, {id:'Br4', c:'brown', t:645, l:65, w:32, h:50, f:2},
        {id:'Y7', c:'yellow', t:585, r:30, w:38, h:75, f:4}, {id:'Y8', c:'yellow', t:650, l:145, w:80, h:45, f:2},
        {id:'Y9', c:'yellow', t:650, l:235, w:80, h:45, f:2}
    ];
    const stockBoxes = [
        {id:'S1', t:70, l:10}, {id:'S2', t:70, l:78}, {id:'S3', t:70, l:146}, {id:'S4', t:70, l:214}, {id:'S5', t:70, l:282},
        {id:'S6', t:140, l:15, w:55, h:90}, {id:'S7', t:140, r:15, w:55, h:90}, {id:'S8', t:240, l:75, w:55, h:90}, {id:'S9', t:305, l:135, w:85, h:45}
    ];

    let isEdit = false, selProd = null, currId = null;
    let storage = JSON.parse(localStorage.getItem('xexy_v5_data')) || {};
    let mList = JSON.parse(localStorage.getItem('xexy_v5_list')) || [];

    function init() {
        createBoxes(shopBoxes, 'shopMap', false);
        createBoxes(stockBoxes, 'stockMap', true);
        renderList();
    }

    function createBoxes(data, targetId, isStock) {
        const target = document.getElementById(targetId);
        data.forEach(b => {
            const div = document.createElement('div');
            div.id = b.id;
            // ì¤‘ìš”: í´ë˜ìŠ¤ ì´ë¦„ì„ ëª…í™•í•˜ê²Œ ë¶€ì—¬
            div.className = `box ${isStock ? 'blue' : b.c}`;
            div.innerText = b.id;
            div.style.cssText = `top:${b.t}px; ${b.l?'left:'+b.l+'px':'right:'+b.r+'px'}; width:${b.w||60}px; height:${b.h||40}px;`;
            div.onclick = () => openPop(b.id, b.f || 8);
            target.appendChild(div);
        });
    }

    function toggleDrawer() { document.getElementById('drawer').classList.toggle('open'); }
    function addProd(e) { if(e.key==='Enter' && e.target.value.trim()){ mList.unshift(e.target.value.trim()); e.target.value=''; saveList(); renderList(); }}
    function renderList() {
        document.getElementById('prodList').innerHTML = mList.map((p, i) => `
            <div class="prod-item ${selProd===p?'selected':''}" onclick="selectProd('${p}')">
                ${p} <button onclick="delProd(event, ${i})" style="border:none; color:#bbb; background:none;">Ã—</button>
            </div>`).join('');
    }
    function selectProd(p) { 
        selProd = (selProd===p) ? null : p;
        document.getElementById('placementBar').style.display = selProd ? 'block' : 'none';
        document.getElementById('selName').innerText = p;
        if(selProd) { if(!isEdit) toggleEdit(); toggleDrawer(); }
        renderList();
    }
    function delProd(e, i) { e.stopPropagation(); if(confirm('ë¦¬ìŠ¤íŠ¸ì—ì„œ ì‚­ì œí• ê¹Œìš”?')){ mList.splice(i,1); saveList(); renderList(); }}

    function openPop(id, f) {
        currId = id; document.getElementById('popTitle').innerText = id + " ìƒì„¸ ì •ë³´";
        const saved = storage[id] || [];
        let html = '';
        for(let i=0; i<f; i++) {
            html += `<div class="layer-row">
                <div style="display:flex; justify-content:space-between; align-items:center;">
                    <b style="color:var(--accent)">${i+1}F</b>
                    ${isEdit ? `<button onclick="placeHere(${i})" style="font-size:11px; padding:3px 8px; border-radius:4px; border:1px solid #ccc; background:#fff; cursor:pointer;">ë°°ì¹˜</button>` : ''}
                </div>
                <textarea id="ipt_${i}" ${!isEdit?'readonly':''} placeholder="í’ˆë²ˆ (ë©”ëª¨)">${saved[i]||''}</textarea>
            </div>`;
        }
        document.getElementById('popLayers').innerHTML = html;
        document.getElementById('overlay').style.display = 'flex';
    }

    function placeHere(idx) {
        if(!selProd) return;
        const ipt = document.getElementById(`ipt_${idx}`);
        let currentText = ipt.value.trim();
        if(currentText.includes(selProd)) {
            alert("ì´ë¯¸ ë°°ì¹˜ëœ í’ˆë²ˆì…ë‹ˆë‹¤.");
        } else {
            ipt.value = currentText ? currentText + ", " + selProd + " ()" : selProd + " ()";
        }
    }

    function save() {
        const ipts = document.querySelectorAll('textarea');
        storage[currId] = Array.from(ipts).map(i => i.value);
        localStorage.setItem('xexy_v5_data', JSON.stringify(storage));
        if(!selProd) closePop();
    }

    function toggleEdit() { isEdit = !isEdit; document.getElementById('editBtn').classList.toggle('active', isEdit); }
    function closePop() { document.getElementById('overlay').style.display = 'none'; }
    function saveList() { localStorage.setItem('xexy_v5_list', JSON.stringify(mList)); }
    
    function search(q) {
        document.querySelectorAll('.box').forEach(b => b.classList.remove('blink'));
        if(!q.trim()) return;
        q = q.toLowerCase();
        for(let id in storage) {
            if(storage[id].some(v => v.toLowerCase().includes(q))) {
                const el = document.getElementById(id);
                if(el) el.classList.add('blink');
            }
        }
    }
    init();
</script>
</body>
</html>
